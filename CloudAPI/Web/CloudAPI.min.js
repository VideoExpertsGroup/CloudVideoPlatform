window.SkyVR={},window.CloudAPI=window.SkyVR,window.CloudAPI.description="API Lib For CloudAPI. Network Layer Between FrontEnd And BackEnd.",window.CloudAPI.config={url:"",url_cameras:"",url_api:"",cameraID:"",user_name:"",vendor:""},window.CloudAPI.lang=function(){return CloudAPI.sLang||CloudAPI.locale()},window.CloudAPI.locale=function(){if(langs=["en","ko","ru"],CloudAPI.sLang="en",CloudAPI.containsPageParam("lang")&&langs.indexOf(CloudAPI.pageParams.lang)>=-1)CloudAPI.sLang=CloudAPI.pageParams.lang;else if(navigator){var e="en";e=navigator.language?navigator.language.substring(0,2):e,e=navigator.browserLanguage?navigator.browserLanguage.substring(0,2):e,e=navigator.systemLanguage?navigator.systemLanguage.substring(0,2):e,e=navigator.userLanguage?navigator.userLanguage.substring(0,2):e,CloudAPI.sLang=langs.indexOf(e)>=-1?e:CloudAPI.sLang}else CloudAPI.sLang="en";return CloudAPI.sLang},window.CloudAPI.setToCookie=function(e,o){var a=new Date((new Date).getTime()+6048e5);document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(o)+"; path=/; expires="+a.toUTCString()},window.CloudAPI.getFromCookie=function(e){var o=document.cookie.match(RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return o?decodeURIComponent(o[1]):""},window.CloudAPI.removeFromCookie=function(e){document.cookie=encodeURIComponent(e)+"=; path=/;"},window.CloudAPI.cache={cameras:{},timezones:{}},window.CloudAPI.cache.cameraInfo=function(e){return e?CloudAPI.cache.cameras[e]:CloudAPI.isCameraID()?CloudAPI.cache.cameras[SkyVR.cameraID()]:void 0},window.CloudAPI.cache.getCameraInfo=CloudAPI.cache.cameraInfo,window.CloudAPI.cache.mergeObjects=function(e,o){for(var a in o){var n=typeof o[a];"boolean"==n||"string"==n||"number"==n?e[a]!=o[a]&&(e[a]&&console.log("Changed "+a),e[a]=o[a]):Array.isArray(o[a])?e[a]=o[a]:"object"==n&&(e[a]||(e[a]={}),e[a]=CloudAPI.cache.mergeObjects(e[a],o[a]))}return e},window.CloudAPI.cache.updateCameraInfo=function(e){var o=e.id;CloudAPI.cache.cameras[o]||(CloudAPI.cache.cameras[o]={}),CloudAPI.cache.cameras[o]=CloudAPI.cache.mergeObjects(CloudAPI.cache.cameras[o],e)},window.CloudAPI.cache.setCameraInfo=function(e){var o=e.id;void 0==SkyVR.cache.cameras[o]&&(SkyVR.cache.cameras[o]={});var a=e.p2p_streaming&&1==e.p2p_streaming?!0:!1,n=CloudAPI.cache.cameras[o];return CloudAPI.cache.cameras[o]=CloudAPI.cache.mergeObjects(n,e),CloudAPI.cache.cameras[o].lastTimeUpdated=Date.now(),a},window.CloudAPI.cache.setP2PSettings=function(e,o){void 0==SkyVR.cache.cameras[e]&&(SkyVR.cache.cameras[e]={}),SkyVR.cache.cameras[e].p2p=o,SkyVR.cache.cameras[e].p2p_settings=SkyVR.cache.cameras[e].p2p},window.CloudAPI.cache.setMemoryCard=function(e,o){void 0==SkyVR.cache.cameras[e]&&(SkyVR.cache.cameras[e]={}),SkyVR.cache.cameras[e].memory_card=o},window.CloudAPI.cache.updateCameraAudio=function(e,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].audio||(CloudAPI.cache.cameras[e].audio={}),SkyVR.cache.cameras[e].audio=CloudAPI.cache.mergeObjects(CloudAPI.cache.cameras[e].audio,o)},window.CloudAPI.cache.cameraAudio=function(e){return e=e||CloudAPI.cameraID(),CloudAPI.cache.cameras[e]?CloudAPI.cache.cameras[e].audio:{}},window.CloudAPI.cache.updateCameraVideo=function(e,o){SkyVR.cache.cameras[e]||(SkyVR.cache.cameras[e]={}),CloudAPI.cache.cameras[e].video||(CloudAPI.cache.cameras[e].video={});var a=CloudAPI.cache.cameras[e].video;CloudAPI.cache.cameras[e].video=CloudAPI.cache.mergeObjects(a,o)},window.CloudAPI.cache.cameraVideo=function(e){return e=e||CloudAPI.cameraID(),CloudAPI.cache.cameras[e]?CloudAPI.cache.cameras[e].video:{}},window.CloudAPI.cache.cameraVideoStreamName=function(e){if(e=e||CloudAPI.cameraID(),!CloudAPI.cache.cameras[e])return{};var o=CloudAPI.cache.cameras[e].video;if(o.streams)for(var a in o.streams)return a},window.CloudAPI.cache.cameraVideoStreams=function(e){if(e=e||CloudAPI.cameraID(),!CloudAPI.cache.cameras[e])return{};var o=CloudAPI.cache.cameras[e].video;return o.streams?o.streams:void 0},window.CloudAPI.cache.setLimits=function(e,o){SkyVR.cache.cameras[e]||(SkyVR.cache.cameras[e]={}),SkyVR.cache.cameras[e].limits=o},window.CloudAPI.cache.updateCameraVideoStream=function(e,o,a){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].video||(CloudAPI.cache.cameras[e].video={}),CloudAPI.cache.cameras[e].video.streams||(CloudAPI.cache.cameras[e].video.streams={}),CloudAPI.cache.cameras[e].video.streams[o]||(CloudAPI.cache.cameras[e].video.streams[o]={});var n=CloudAPI.cache.cameras[e].video.streams[o];CloudAPI.cache.cameras[e].video.streams[o]=CloudAPI.cache.mergeObjects(n,a)},window.CloudAPI.cache.setAudioStream=function(e,o,a){SkyVR.cache.cameras[e]||(SkyVR.cache.cameras[e]={}),SkyVR.cache.cameras[e].audio||(SkyVR.cache.cameras[e].audio={}),SkyVR.cache.cameras[e].audio.streams||(SkyVR.cache.cameras[e].audio.streams={}),SkyVR.cache.cameras[e].audio.streams[o]=a},window.CloudAPI.cache.setMediaStreams=function(e,o){SkyVR.cache.cameras[e]||(SkyVR.cache.cameras[e]={}),SkyVR.cache.cameras[e].media_streams=o},window.CloudAPI.cache.updateEventProcessingEventsMotion=function(e,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].event_processing||(CloudAPI.cache.cameras[e].event_processing={}),CloudAPI.cache.cameras[e].event_processing.events||(CloudAPI.cache.cameras[e].event_processing.events={}),CloudAPI.cache.cameras[e].event_processing.events.motion||(CloudAPI.cache.cameras[e].event_processing.events.motion={});var a=CloudAPI.cache.cameras[e].event_processing.events.motion;CloudAPI.cache.cameras[e].event_processing.events.motion=CloudAPI.cache.mergeObjects(a,o)},window.CloudAPI.cache.updateCameraEventProcessingEventsSound=function(e,o){CloudAPI.cache.cameras[e]||(CloudAPI.cache.cameras[e]={}),CloudAPI.cache.cameras[e].event_processing||(CloudAPI.cache.cameras[e].event_processing={}),CloudAPI.cache.cameras[e].event_processing.events||(CloudAPI.cache.cameras[e].event_processing.events={}),CloudAPI.cache.cameras[e].event_processing.events.sound||(CloudAPI.cache.cameras[e].event_processing.events.sound={});var a=CloudAPI.cache.cameras[e].event_processing.events.sound;CloudAPI.cache.cameras[e].event_processing.events.sound=CloudAPI.cache.mergeObjects(a,o)},window.CloudAPI.parsePageParams=function(){for(var e=window.location.search.slice(1),o=e.split("&"),a={},n=RegExp("(.*)=([^&#]*)"),t=0;o.length>t;t++)""!=o[t].trim()&&(p=n.exec(o[t].trim()),null==p?a[decodeURIComponent(o[t].trim().replace(/\+/g," "))]="":a[decodeURIComponent(p[1].replace(/\+/g," "))]=decodeURIComponent(p[2].replace(/\+/g," ")));return a},window.CloudAPI.pageParams=CloudAPI.parsePageParams(),window.CloudAPI.containsPageParam=function(e){return CloudAPI.pageParams[e]!==void 0},window.CloudAPI.generateNewLocation=function(e){var o=[];return CloudAPI.containsPageParam("lang")&&o.push("lang="+encodeURIComponent(CloudAPI.pageParams.lang)),CloudAPI.containsPageParam("vendor")&&o.push("vendor="+encodeURIComponent(CloudAPI.pageParams.vendor)),CloudAPI.containsPageParam("mobile")&&o.push("mobile="+encodeURIComponent(CloudAPI.pageParams.mobile)),o.push("p="+encodeURIComponent(e)),"?"+o.join("&")},window.CloudAPI.changeLocationState=function(e){var o=[];CloudAPI.containsPageParam("lang")&&o.push("lang="+encodeURIComponent(CloudAPI.pageParams.lang)),CloudAPI.containsPageParam("url")&&o.push("lang="+encodeURIComponent(CloudAPI.pageParams.url)),CloudAPI.containsPageParam("fcno")&&o.push("fcno="+encodeURIComponent(CloudAPI.pageParams.fcno)),CloudAPI.containsPageParam("vendor")&&o.push("vendor="+encodeURIComponent(CloudAPI.pageParams.vendor)),CloudAPI.containsPageParam("demo")&&o.push("demo="+encodeURIComponent(CloudAPI.pageParams.demo)),CloudAPI.containsPageParam("hls")&&o.push("hls="+encodeURIComponent(CloudAPI.pageParams.hls)),CloudAPI.containsPageParam("svcp_host")&&o.push("svcp_host="+encodeURIComponent(CloudAPI.pageParams.svcp_host)),CloudAPI.containsPageParam("mobile")&&o.push("mobile="+encodeURIComponent(CloudAPI.pageParams.mobile));for(var a in e)o.push(encodeURIComponent(a)+"="+encodeURIComponent(e[a]));var n=window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+o.join("&");try{window.history.pushState?window.history.pushState(e,document.title,n):console.error("window.history.pushState - function not found")}catch(t){console.error("changeLocationState: Could not change location to "+n)}CloudAPI.pageParams=CloudAPI.parsePageParams()},window.CloudAPI.setURL=function(e){if(CloudAPI.config.url!=e){CloudAPI.config.url=e,CloudAPI.config.url_api=e+"api/v2/",CloudAPI.config.url_cameras=e+"api/v2/cameras/",CloudAPI.config.url_admin_cameras=e+"api/v2/admin/cameras/",CloudAPI.config.url_camsess=e+"api/v2/camsess/",CloudAPI.config.url_server=e+"api/v2/server/",CloudAPI.config.url_account=e+"api/v2/account/",CloudAPI.config.url_cmngrs=e+"api/v2/cmngrs/",CloudAPI.config.url_storage=e+"api/v2/storage/",CloudAPI.config.url_clips=e+"api/v2/storage/clips/",CloudAPI.config.anonToken={token:"",type:"anon",expire:"",expireTimeUTC:0},localStorage.getItem("SkyVR_anonToken")&&(CloudAPI.config.anonToken=JSON.parse(localStorage.getItem("SkyVR_anonToken"))),CloudAPI.config.apiToken={token:"",type:"api",expire:"",expireTimeUTC:0},CloudAPI.config.shareToken={};var o=CloudAPI.getFromStorage("SkyVR_apiToken");if(o){var a=JSON.parse(o);a.expireTimeUTC>Date.now()&&(CloudAPI.config.apiToken=a)}CloudAPI.setToStorage("CloudAPI_svcp_host",e)}},CloudAPI.isExpiredApiToken=function(){return CloudAPI.config.apiToken.expireTimeUTC?CloudAPI.config.apiToken.expireTimeUTC>Date.now()?!1:!0:!0},CloudAPI.applyApiToken=function(){$.ajaxSetup({crossDomain:!0,cache:!1,beforeSend:function(e){CloudAPI.config.apiToken&&CloudAPI.config.apiToken.token&&e.setRequestHeader("Authorization","SkyVR "+CloudAPI.config.apiToken.token)}})},$.support.cors=!0,CloudAPI.updatePageProgressCaption=function(){var e={en:"Loading...",ru:"Загрузка...",ko:"카메라 정보 가져오는 중...",it:"Caricamento in corso..."};try{document.getElementById("progress-caption")&&(document.getElementById("progress-caption").innerHTML=e[CloudAPI.lang()]?e[CloudAPI.lang()]:e.en)}catch(o){}},window.CloudAPI.loadVendorScripts=function(e,o){if(""!=e){var a=document.createElement("script");a.type="text/javascript",a.src=(o?o:"./")+"vendor/"+e+"/cc.js",document.head.appendChild(a),a.onload=function(){CloudAPI.updatePageProgressCaption(),CloudAPI.containsPageParam("customswf")&&(cc.custom_videojs_swf="swf/video-js-custom-vxg.swf"),CloudAPI.onLoadedVendorScript&&CloudAPI.onLoadedVendorScript()},a.onerror=function(){console.error("Not found vendor use default"),CloudAPI.config.vendor="VXG",CloudAPI.loadVendorScripts(CloudAPI.config.vendor,o)};var n=document.createElement("link");n.rel="stylesheet",n.href=(o?o:"./")+"vendor/"+e+"/cc.min.css",document.head.appendChild(n);var t=document.createElement("link");t.rel="stylesheet",t.href=(o?o:"./")+"vendor/"+e+"/pageloader.min.css",document.head.appendChild(t)}else console.log("Not found vendor"),CloudAPI.loadVendorScripts("VXG",o)},CloudAPI.updateApiToken=function(){var e=$.Deferred();return $.ajax({url:CloudAPI.config.url_account+"token/api/",type:"GET",contentType:"application/json"}).done(function(o){CloudAPI.config.apiToken.token=o.token,CloudAPI.config.apiToken.expire=o.expire,CloudAPI.config.apiToken.expireTimeUTC=Date.parse(o.expire+"Z"),CloudAPI.config.apiToken.type=o.type,CloudAPI.setToStorage("SkyVR_apiToken",JSON.stringify(SkyVR.config.apiToken)),console.log("Updated token: ",SkyVR.config.apiToken),e.resolve(o)}).fail(function(){e.reject()}),e},window.CloudAPI.url=function(){return CloudAPI.config.url},CloudAPI.setCameraID=function(e){CloudAPI.config.cameraID!=e&&e?(CloudAPI.config.cameraID=e,console.log("[CLOUDAPI] new cam id: "+e),CloudAPI.cache.camera||SkyVR.cameraInfo().done(function(e){CloudAPI.cache.camera=e})):e||(CloudAPI.config.cameraID=void 0,CloudAPI.cache.camera=void 0)},CloudAPI.cameraID=function(){return CloudAPI.config.cameraID},CloudAPI.cameraManagerID=function(){return CloudAPI.cache.cameras[CloudAPI.config.cameraID].cmngrid},CloudAPI.isCameraID=function(){return void 0==CloudAPI.config.cameraID?(console.error("[CLOUDAPI] cameraID is undefined"),!1):!0},CloudAPI.isP2PStreaming_byId=function(e){var o=SkyVR.cache.cameras[e];return o&&o.p2p_streaming&&1==o.p2p_streaming?!0:!1},CloudAPI.isP2PStreaming=function(){return void 0==SkyVR.cache.cameraInfo()?(console.error("[CLOUDAPI] cameraID is undefined"),!1):SkyVR.isP2PStreaming_byId(SkyVR.cache.cameraInfo().id)},CloudAPI.hasMemoryCard_byId=function(e){var o=SkyVR.cache.cameras[e];return o&&o.memory_card&&"none"!=o.memory_card.status?!0:!1},CloudAPI.hasMemoryCard=function(){return void 0==SkyVR.cache.cameraInfo()?(console.error("[CLOUDAPI] cameraID is undefined"),!1):SkyVR.hasMemoryCard_byId(SkyVR.cache.cameraInfo().id)},CloudAPI.parseUTCTime=function(e){e=e.replace(RegExp("-","g")," "),e=e.replace(RegExp("T","g")," "),e=e.replace(RegExp(":","g")," ");var o=e.split(" "),a=new Date;return a.setUTCFullYear(parseInt(o[0],10)),a.setUTCMonth(parseInt(o[1],10)-1),a.setUTCDate(parseInt(o[2],10)),a.setUTCHours(parseInt(o[3],10)),a.setUTCMinutes(parseInt(o[4],10)),a.setUTCSeconds(parseInt(o[5],10)),a.getTime()},CloudAPI.convertUTCTimeToUTCStr=function(e){var o=new Date;o.setTime(e);var a=o.getUTCFullYear()+"-"+("00"+(o.getUTCMonth()+1)).slice(-2)+"-"+("00"+o.getUTCDate()).slice(-2)+"T"+("00"+o.getUTCHours()).slice(-2)+":"+("00"+o.getUTCMinutes()).slice(-2)+":"+("00"+o.getUTCSeconds()).slice(-2);return a},CloudAPI.convertUTCTimeToStr=function(e){var o=new Date;o.setTime(e);var a=["short_Jan","short_Feb","short_Mar","short_Apr","short_May","short_June","short_July","short_Aug","short_Sep","short_Oct","short_Nov","short_Dec"],n=o.getUTCDate()+SkyUI.polyglot.t(a[o.getUTCMonth()])+" "+o.getUTCFullYear()+" "+("00"+o.getUTCHours()).slice(-2)+":"+("00"+o.getUTCMinutes()).slice(-2)+":"+("00"+o.getUTCSeconds()).slice(-2);return"ko"==CloudAPI.lang()&&(n=("00"+(o.getUTCMonth()+1)).slice(-2)+"/"+("00"+o.getUTCDate()).slice(-2)+"/"+o.getUTCFullYear()+" "+("00"+o.getUTCHours()).slice(-2)+":"+("00"+o.getUTCMinutes()).slice(-2)+":"+("00"+o.getUTCSeconds()).slice(-2)),n},CloudAPI.convertUTCTimeToSimpleStr=function(e){var o=new Date;o.setTime(e);var a=o.getUTCFullYear()+"-"+("00"+(o.getUTCMonth()+1)).slice(-2)+"-"+("00"+o.getUTCDate()).slice(-2)+" "+("00"+o.getUTCHours()).slice(-2)+":"+("00"+o.getUTCMinutes()).slice(-2)+":"+("00"+o.getUTCSeconds()).slice(-2);return a},window.CloudAPI.getOffsetTimezone=function(){var e=CloudAPI.cache.cameraInfo();if(!e)return 0;if(void 0==CloudAPI.cache.timezones[e.timezone]){var o=new Date;if(e.timezone&&""!=e.timezone){var a=moment(o).tz(e.timezone).format("Z"),n=a[0];("0">n||n>"9")&&(a=a.substring(1));var t="-"==n?-1:1,r=a.split(":");a=t*(60*parseInt(r[0],10)+parseInt(r[1],10)),CloudAPI.cache.timezones[e.timezone]=6e4*a}else CloudAPI.cache.timezones[e.timezone]=0}return CloudAPI.cache.timezones[e.timezone]},window.CloudAPI.getCurrentTimeUTC=function(){return Date.now()},window.CloudAPI.getCurrentTimeByCameraTimezone=function(){return Date.now()+CloudAPI.getOffsetTimezone()},window.CloudAPI.enable401handler=function(){},window.CloudAPI.disable401handler=function(){$.ajaxSetup({error:function(){}})},window.CloudAPI.printStack=function(){var e=Error();console.error(e.stack)},window.CloudAPI.PAGE_SIGNIN="signin",window.CloudAPI.hasAccess=function(e,o){if(SkyUI.isDemo())return!0;if(!e)return!1;if(!e.access)return!0;var a=!1;for(var n in e.access)e.access[n]==o&&(a=!0);return a},window.CloudAPI.hasAccessSettings=function(e){return SkyUI.isDemo()?!0:(e=e||CloudAPI.cache.cameraInfo(),SkyVR.hasAccess(e,"all"))},window.CloudAPI.hasAccessClips=function(e){return SkyUI.isDemo()?!0:SkyVR.hasAccess(e,"clipping")||SkyVR.hasAccess(e,"clipplay")||SkyVR.hasAccess(e,"watch")||SkyVR.hasAccess(e,"cplay")||SkyVR.hasAccess(e,"all")},window.CloudAPI.hasAccessLive=function(e){return SkyUI.isDemo()?!0:SkyVR.hasAccess(e,"ptz")||SkyVR.hasAccess(e,"live")||SkyVR.hasAccess(e,"watch")||SkyVR.hasAccess(e,"all")},window.CloudAPI.hasAccessPlayback=function(e){return SkyUI.isDemo()?!0:SkyVR.hasAccess(e,"clipping")||SkyVR.hasAccess(e,"play")||SkyVR.hasAccess(e,"watch")||SkyVR.hasAccess(e,"splay")||SkyVR.hasAccess(e,"all")},window.CloudAPI.hasAccessMakeClip=function(e){return SkyUI.isDemo()?!0:SkyVR.hasAccess(e,"clipping")||SkyVR.hasAccess(e,"all")},window.CloudAPI.handleNothing=function(){},window.CloudAPI.handleNothingError=function(){},window.CloudAPI.handleError=function(e,o,a){console.error(a)},CloudAPI.parseUri=function(e){function o(e){for(var a=o.options,n=a.parser[a.strictMode?"strict":"loose"].exec(e),t={},r=14;r--;)t[a.key[r]]=n[r]||"";return t[a.q.name]={},t[a.key[12]].replace(a.q.parser,function(e,o,n){o&&(t[a.q.name][o]=n)}),t}return o.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},o(e)},CloudAPI.logout=function(e){$.ajax({url:CloudAPI.config.url_account+"logout/",type:"POST",success:e,error:SkyVR.handleError})},CloudAPI.cameraVideoStream=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var a=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+a+"/video/streams/"+e+"/",type:"GET"}).done(function(n){CloudAPI.cache.updateCameraVideoStream(a,e,n),o.resolve(n)}).fail(function(){o.reject()}),o},CloudAPI.cameraLimits=function(){var e=$.Deferred();if(!CloudAPI.isCameraID())return e.reject(),e;var o=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+o+"/limits/",type:"GET"}).done(function(o){SkyVR.cache.setLimits(SkyVR.cameraID(),o),e.resolve(o)}).fail(function(){e.reject()}),e},CloudAPI.cameraEventProcessingEventsMotion=function(){var e=$.Deferred();if(!CloudAPI.isCameraID())return e.reject(),e;var o=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+o+"/event_processing/events/motion/",type:"GET"}).done(function(a){CloudAPI.cache.updateEventProcessingEventsMotion(o,a),e.resolve(a)}).fail(function(){e.reject()}),e},CloudAPI.updateCameraEventProcessingEventsMotion=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var a=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+a+"/event_processing/events/motion/",type:"PUT",data:JSON.stringify(e),contentType:"application/json"}).done(function(){CloudAPI.cache.updateEventProcessingEventsMotion(a,e),o.resolve()}).fail(function(){o.reject()}),o},window.CloudAPI.cameraEventProcessingEventsSound=function(){var e=$.Deferred();if(!CloudAPI.isCameraID())return e.reject(),e;var o=CloudAPI.config.cameraID;return $.ajax({url:CloudAPI.config.url_cameras+o+"/event_processing/events/sound/",type:"GET"}).done(function(a){CloudAPI.cache.updateCameraEventProcessingEventsSound(o,a),e.resolve(a)}).fail(function(){e.reject()}),e},window.CloudAPI.cameraSendPtz=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var a=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+a+"/send_ptz/",type:"POST",data:JSON.stringify(e),contentType:"application/json"}).done(function(e){console.log(e),o.resolve()}).fail(function(){o.reject()}),o},CloudAPI.updateCameraEventProcessingEventsSound=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var a=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+a+"/event_processing/events/sound/",type:"PUT",data:JSON.stringify(e),contentType:"application/json"}).done(function(){CloudAPI.cache.updateCameraEventProcessingEventsSound(a,e),o.resolve()}).fail(function(){o.reject()}),o},CloudAPI.updateCameraVideoStream=function(e,o){var a=$.Deferred();if(!CloudAPI.isCameraID())return a.reject(),a;var n=SkyVR.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+n+"/video/streams/"+e+"/",type:"PUT",data:JSON.stringify(o),contentType:"application/json"}).done(function(){console.log("[CLOUDAPI] [CLOUDAPI] Updated video/streams/"+e+" in cache for "+n),CloudAPI.cache.updateCameraVideoStream(n,e,o),a.resolve()}).fail(function(){a.reject()}),a},window.CloudAPI.setVBRQuality=function(e,o,a,n){if(CloudAPI.isCameraID()){a=void 0==a?SkyVR.handleNothing:a,n=void 0==n?SkyVR.handleError:n;var t={};t.vbr_quality=e,t.vbr=!0,$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.config.cameraID+"/video/streams/"+o+"/",type:"PUT",success:a,error:a,data:JSON.stringify(t),contentType:"application/json"})}},window.CloudAPI.formatMemoryCard=function(){var e=$.Deferred();if(!SkyVR.isCameraID())return e.reject(),e;var o=SkyVR.config.cameraID;return $.ajax({url:SkyVR.config.url_cameras+o+"/format_memory_card/",type:"POST"}).done(function(o){e.resolve(o)}).fail(function(){e.reject()}),e},CloudAPI.cameraMemoryCard=function(e){var o=$.Deferred(),e=e||SkyVR.config.cameraID;return e?($.ajax({url:SkyVR.config.url_cameras+e+"/memory_card/",type:"GET"}).done(function(a){SkyVR.cache.setMemoryCard(e,a),o.resolve(a)}).fail(function(){SkyVR.cache.setMemoryCard(e,{status:"none"}),o.reject()}),o):(o.reject(),o)},CloudAPI.cameraWifi=function(){var e=$.Deferred();return CloudAPI.isCameraID()?($.ajax({url:CloudAPI.config.url_cameras+CloudAPI.config.cameraID+"/wifi/",type:"GET"}).done(function(o){e.resolve(o)}).fail(function(){e.reject()}),e):(e.reject(),e)},window.CloudAPI.cameraFirmwares=function(){var e=$.Deferred();return CloudAPI.isCameraID()?($.ajax({url:CloudAPI.config.url_cameras+CloudAPI.config.cameraID+"/firmwares/?limit=1000",type:"GET",contentType:"application/json"}).done(function(o){e.resolve(o.objects)}).fail(function(){e.reject()}),e):(e.reject(),e)},window.CloudAPI.cameraFirmwaresUpgrade=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;console.log("[CLOUDAPI] upgrade firmware to version: "+e);var a={};return a.version=e,$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.config.cameraID+"/firmwares/upgrade/",type:"POST",data:JSON.stringify(a),contentType:"application/json"}).done(function(){o.resolve()}).fail(function(e,a){console.error("[CLOUDAPI] cameraFirmwaresUpgrade, "+a,e),o.reject()}),o},CloudAPI.accountInfo=function(){var e=$.Deferred();return $.ajax({url:CloudAPI.config.url_account,type:"GET",cache:!1}).done(function(o){CloudAPI.cache.account=o,e.resolve(o)}).fail(function(o){console.log("Fail "+CloudAPI.config.url_account),console.error(o),e.reject(o)}),e},window.CloudAPI.anonToken=function(){var e=$.Deferred(),o=Date.now(),a=SkyVR.config.anonToken.expireTimeUTC-6e5,n=SkyVR.config.anonToken.expireTimeUTC-3e5;return o>a&&n>o?($.ajaxSetup({crossDomain:!0,cache:!1,headers:{Authorization:"SkyVR "+SkyVR.config.anonToken.token}}),e.resolve(SkyVR.config.anonToken)):$.ajax({url:CloudAPI.config.url_account+"token/anon/",type:"GET"}).done(function(o){SkyVR.config.anonToken.token=o.token,SkyVR.config.anonToken.type=o.type,SkyVR.config.anonToken.expire=o.expire,SkyVR.config.anonToken.expireTimeUTC=Date.parse(o.expire+"Z"),CloudAPI.setToStorage("SkyVR_anonToken",JSON.stringify(SkyVR.config.anonToken)),$.ajaxSetup({crossDomain:!0,cache:!1,headers:{Authorization:"SkyVR "+o.token}}),e.resolve(SkyVR.config.anonToken)}).fail(function(){e.reject()}),e},CloudAPI.accountShare=function(e){var o={};return o.camid=SkyVR.cameraID(),$.ajax({url:CloudAPI.config.url_account+"share/",type:"POST",data:JSON.stringify(e),contentType:"application/json",cache:!1})},CloudAPI.capabilities=function(e,o){e=void 0==e?SkyVR.handleNothing:e,o=void 0==o?SkyVR.handleError:o,$.ajax({url:SkyVR.config.url_api+"capabilities/",type:"GET",success:e,error:o})},CloudAPI.cameraInfo=function(e){var o=$.Deferred();return e=e||CloudAPI.cameraID(),void 0==e?(o.reject(),o):$.ajax({url:CloudAPI.config.url_cameras+e+"/",type:"GET"}).done(function(a){SkyVR.cache.cameras[a.id]&&!SkyVR.cache.cameras[a.id].memory_card?(console.log("cameraInfo cahce has not memory card info for camid="+a.id),SkyVR.cameraMemoryCard(a.id)):SkyVR.cache.cameras[a.id]||(console.log("cameraInfo has not in cache for camid="+a.id),SkyVR.cameraMemoryCard(a.id)),SkyVR.cache.setCameraInfo(a)?SkyVR.cameraP2PSettings(e).done(function(){o.resolve(SkyVR.cache.cameras[e])}).fail(function(){o.resolve(SkyVR.cache.cameras[e])}):o.resolve(SkyVR.cache.cameras[e])}).fail(function(){o.reject()})},window.CloudAPI.updateCamera=function(e){var o=$.Deferred();return CloudAPI.isCameraID()?($.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/",type:"PUT",data:JSON.stringify(e),contentType:"application/json"}).done(function(a){console.log("[CLOUDAPI] Updated camera in cache for "+CloudAPI.cameraID()),e.id=CloudAPI.cameraID(),CloudAPI.cache.updateCameraInfo(e),o.resolve(a)}).fail(function(){o.reject()}),o):(o.reject(),o)},window.CloudAPI.updateCameraAudio=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var a=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+a+"/audio/",type:"PUT",data:JSON.stringify(e),contentType:"application/json"}).done(function(n){console.log("[CLOUDAPI] Updated audio in cache for "+a),CloudAPI.cache.updateCameraAudio(a,e),o.resolve(n)}).fail(function(){o.reject()}),o},window.CloudAPI.cameraAudio=function(){var e=$.Deferred();if(!CloudAPI.isCameraID())return e.reject(),e;var o=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+o+"/audio/",type:"GET"}).done(function(a){CloudAPI.cache.updateCameraAudio(o,a),e.resolve(a)}).fail(function(){e.reject()}),e},window.CloudAPI.cameraVideo=function(){var e=$.Deferred();if(!CloudAPI.isCameraID())return e.reject(),e;var o=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+o+"/video/",type:"GET"}).done(function(a){CloudAPI.cache.updateCameraVideo(o,a),e.resolve(a)}).fail(function(){e.reject()}),e},window.CloudAPI.updateCameraVideo=function(e){var o=$.Deferred();if(!CloudAPI.isCameraID())return o.reject(),o;var a=CloudAPI.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+a+"/video/",type:"PUT",contentType:"application/json",data:JSON.stringify(e)}).done(function(n){CloudAPI.cache.updateCameraVideo(a,e),o.resolve(n)}).fail(function(){o.reject()}),o},CloudAPI.setCameraVideo=function(e,o,a){return CloudAPI.isCameraID()?(o=o||SkyVR.handleNothing,a=a||SkyVR.handleError,$.ajax({url:CloudAPI.config.url_cameras+SkyVR.cameraID()+"/video/",type:"PUT",success:o,error:a,contentType:"application/json",data:JSON.stringify(e)})):void 0},CloudAPI.cameraMediaStreams=function(){var e=$.Deferred();if(!CloudAPI.isCameraID())return e.reject(),e;var o=SkyVR.cameraID();return $.ajax({url:CloudAPI.config.url_cameras+o+"/media_streams/",type:"GET"}).done(function(a){SkyVR.cache.setMediaStreams(o,a),e.resolve(a)}).fail(function(){e.reject()}),e},CloudAPI.cameraLiveUrls=function(e){var o=$.Deferred();return(e=e||CloudAPI.cameraID())?($.ajax({url:CloudAPI.config.url_cameras+e+"/live_urls/",type:"GET"}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}),o):(o.reject(),o)},window.CloudAPI.cameraBackwardStart=function(){if(CloudAPI.isCameraID()){var e={};CloudAPI.config.backwardURL&&(e.url=CloudAPI.config.backwardURL,CloudAPI.config.tmpBackwardURL==CloudAPI.config.backwardURL?CloudAPI.config.tmpBackwardURLCount++:(CloudAPI.config.tmpBackwardURLCount=1,CloudAPI.config.tmpBackwardURL=CloudAPI.config.backwardURL),CloudAPI.isP2PStreaming()&&(console.log("[CLOUDAPI] Send (audio streaming) backward start: "+CloudAPI.config.backwardURL),$.ajax({url:CloudAPI.config.url_cameras+SkyVR.cameraID()+"/audio/backward/start/",type:"POST",success:SkyVR.handleNothing,data:JSON.stringify(e),contentType:"application/json"})))}},window.CloudAPI.cameraBackwardStop=function(){if(CloudAPI.isCameraID()){var e={};if(CloudAPI.config.backwardURL){if(e.url=CloudAPI.config.backwardURL,CloudAPI.config.tmpBackwardURL==CloudAPI.config.backwardURL){if(0==CloudAPI.config.tmpBackwardURLCount)return;CloudAPI.config.tmpBackwardURLCount--}CloudAPI.isP2PStreaming()&&(console.log("[CLOUDAPI] Send (audio streaming) backward stop: "+CloudAPI.config.backwardURL),$.ajax({url:CloudAPI.config.url_cameras+SkyVR.cameraID()+"/audio/backward/stop/",type:"POST",success:SkyVR.handleNothing,data:JSON.stringify(e),contentType:"application/json"}))}}},window.CloudAPI.cameraSchedule=function(){return CloudAPI.isCameraID()?$.ajax({url:CloudAPI.config.url_cameras+CloudAPI.cameraID()+"/schedule/",type:"GET",cache:!1}):void 0},window.CloudAPI.updateCameraSchedule=function(e){return $.ajax({url:CloudAPI.config.url_cameras+SkyVR.cameraID()+"/schedule/",type:"PUT",data:JSON.stringify(e),cache:!1,contentType:"application/json"})},window.CloudAPI.hasAccessCameraPreview=function(e){var o=SkyVR.cache.cameraInfo(e);return o?SkyVR.hasAccess(o,"live")||SkyVR.hasAccess(o,"all")||SkyVR.hasAccess(o,"ptz"):!1},window.CloudAPI.cameraPreview=function(e,o,a){return o=void 0==o?SkyVR.handleNothing:o,a=void 0==a?SkyVR.handleError:a,$.ajax({url:CloudAPI.config.url_cameras+e+"/preview/",type:"GET",success:o,error:a})},window.CloudAPI.hasAccessCameraUpdatePreview=function(e){var o=SkyVR.cache.cameraInfo(e);return o?SkyVR.hasAccess(o,"live")||SkyVR.hasAccess(o,"all")||SkyVR.hasAccess(o,"ptz"):!1},window.CloudAPI.cameraUpdatePreview=function(e){return $.ajax({url:CloudAPI.config.url_cameras+e+"/preview/update/",type:"POST"})},window.CloudAPI.storageDataFirstRecord=function(e){var o=$.Deferred(),a={camid:CloudAPI.cameraID(),limit:1,offset:0};return e&&(a.start=e),$.ajax({url:SkyVR.config.url_storage+"data/",data:a,cache:!1,type:"GET"}).done(function(e){e.objects.length>0?o.resolve(e.objects[0]):o.reject()}).fail(function(){o.reject()}),o},window.CloudAPI.storageEventsFirstRecord=function(){var e=$.Deferred(),o={camid:SkyVR.cameraID(),limit:1,offset:0};return $.ajax({url:SkyVR.config.url_storage+"events/",data:o,cache:!1,type:"GET"}).done(function(o){o.objects.length>0?e.resolve(o.objects[0]):e.reject()}).fail(function(){e.reject()}),e},window.CloudAPI.storageThumbnailsFirstRecord=function(){var e=$.Deferred(),o={camid:SkyVR.cameraID(),limit:1,offset:0};return $.ajax({url:SkyVR.config.url_storage+"thumbnails/",data:o,cache:!1,type:"GET"}).done(function(o){o.objects.length>0?e.resolve(o.objects[0]):e.reject()}).fail(function(){e.reject()}),e},window.CloudAPI.getAllData=function(){},window.CloudAPI.storageThumbnails=function(e,o){function a(e){var o=$.Deferred();return $.ajax({url:SkyVR.config.url_storage+"thumbnails/",data:e,cache:!1,async:!0,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}var n=$.Deferred(),t={meta:{limit:1e3,offset:0,total_count:-1},objects:[]},r={camid:SkyVR.cameraID(),limit:t.meta.limit,offset:t.meta.offset,start:e};return o&&(r.end=o),a(r).fail(function(){n.reject()}).done(function(e){if(t.meta.total_count=e.meta.total_count,t.meta.expire=e.meta.expire,$.merge(t.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)n.resolve(t);else{for(var o=[],c=t.meta.limit;e.meta.total_count>c;c+=t.meta.limit)r.offset=c,o.push(a(r));$.when.apply($,o).done(function(){for(var e=0;arguments.length>e;e++)$.merge(t.objects,arguments[e].objects);n.resolve(t)}).fail(function(){n.reject()})}}),n},CloudAPI.storageTimeline=function(e,o){function a(e){var o=$.Deferred();return $.ajax({url:SkyVR.config.url_storage+"timeline/"+SkyVR.cameraID()+"/",data:e,cache:!1,async:!0,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}var n=$.Deferred(),t={meta:{limit:1e3,offset:0,total_count:-1},objects:[]},r={slices:1,camid:SkyVR.cameraID(),limit:t.meta.limit,offset:t.meta.offset,start:e};return o&&(r.end=o),a(r).fail(function(){n.reject()}).done(function(e){if(t.meta.total_count=e.meta.total_count,t.meta.expire=e.meta.expire,$.merge(t.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)n.resolve(t);
else{for(var o=[],c=t.meta.limit;e.meta.total_count>c;c+=t.meta.limit)r.offset=c,o.push(a(r));$.when.apply($,o).done(function(){for(var e=0;arguments.length>e;e++)$.merge(t.objects,arguments[e].objects);n.resolve(t)}).fail(function(){n.reject()})}}),n},window.CloudAPI.storageData=function(e,o){function a(e){var o=$.Deferred();return $.ajax({url:SkyVR.config.url_storage+"data/",data:e,cache:!1,async:!0,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}),o}var n=$.Deferred(),t={meta:{limit:1e3,offset:0,total_count:-1},objects:[]},r={camid:SkyVR.cameraID(),limit:t.meta.limit,offset:t.meta.offset,start:e};return o&&(r.end=o),a(r).fail(function(){n.reject()}).done(function(e){if(t.meta.total_count=e.meta.total_count,t.meta.expire=e.meta.expire,$.merge(t.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)n.resolve(t);else{for(var o=[],c=t.meta.limit;e.meta.total_count>c;c+=t.meta.limit)r.offset=c,o.push(a(r));$.when.apply($,o).done(function(){for(var e=0;arguments.length>e;e++)$.merge(t.objects,arguments[e].objects);n.resolve(t)}).fail(function(){n.reject()})}}),n},window.CloudAPI.storageEvents=function(e,o){function a(e){var o=$.Deferred();return $.ajax({url:SkyVR.config.url_storage+"events/",data:e,cache:!1,async:!0,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}var n=$.Deferred(),t={meta:{limit:1e3,offset:0,total_count:-1},objects:[]},r={camid:SkyVR.cameraID(),limit:t.meta.limit,offset:t.meta.offset,start:e};return o&&(r.end=o),a(r).fail(function(){n.reject()}).done(function(e){if(t.meta.total_count=e.meta.total_count,t.meta.expire=e.meta.expire,$.merge(t.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)n.resolve(t);else{for(var o=[],c=t.meta.limit;e.meta.total_count>c;c+=t.meta.limit)r.offset=c,o.push(a(r));$.when.apply($,o).done(function(){for(var e=0;arguments.length>e;e++)$.merge(t.objects,arguments[e].objects);n.resolve(t)}).fail(function(){n.reject()})}}),n},window.CloudAPI.hasAccessMotionDetection=function(e){var o=SkyVR.cache.cameraInfo(e);return o?SkyVR.hasAccess(o,"all")||SkyVR.hasAccess(o,"ptz"):!1},window.CloudAPI.cameraMotionDetectionDemo=function(){var e=JSON.parse('{"caps": {"columns": 23, "max_regions": 8, "region_shape": "rect", "rows": 15, "sensitivity": "region"}}');return e},window.CloudAPI.cameraMotionDetection=function(){return $.ajax({url:CloudAPI.config.url_cameras+SkyVR.cameraID()+"/motion_detection/",type:"GET"})},window.CloudAPI.cameraMotionDetectionRegionsDemo=function(){var e=JSON.parse('{"meta": {"limit": 20, "next": null, "offset": 0, "previous": null, "total_count": 8}, "objects": [{"enabled": true, "id": 2686, "map": "ZmQwMDBjM2ZjMDAwN2Y4MDAwZmYwMDAxZmUwMDAzZmNlNjAw", "name": "motion1", "sensitivity": 5}, {"enabled": true, "id": 2687, "map": "ZjYwMDBmMGZmODAwMWZmMDAwM2ZlMDAwN2ZjMDAwZmY4MDAxZmZmMDAw", "name": "motion2", "sensitivity": 5}, {"enabled": true, "id": 2688, "map": "ZjQwMDBmM2ZlMDAwN2ZjMDAwZmY4MDAxZmYwMDAzZmUwMDA3ZmNmMjAw", "name": "motion3", "sensitivity": 5}, {"enabled": true, "id": 2689, "map": "ZWMwMDBjMWZlMDAwM2ZjMDAwN2Y4MDAwZmYwMDAxZmVmNzAw", "name": "motion4", "sensitivity": 5}, {"enabled": true, "id": 2690, "map": "ZTQwMDA2ZTAwMDAxYzAwMDAzODBmOTAw", "name": "motion5", "sensitivity": 5}, {"enabled": true, "id": 2691, "map": "MmIwMWZmMDAwM2ZlMDAwN2ZjMDAwZmY4MDAxZmYwMDAzZmUwMDA3ZmMwMDBmZjgwMDFmZjAwMDNmZTAwMDdmYzAwMGZmODAwMWZmMDAwM2ZlMDAwN2ZjMDAw", "name": "motion6", "sensitivity": 5}, {"enabled": true, "id": 2692, "map": "MTJmZjgwMDFmZjAwMDNmZTAwMDdmYzAwMGZmODAwMWZmMDAwM2ZlMGU4MDA=", "name": "motion7", "sensitivity": 5}, {"enabled": false, "id": 2693, "map": "", "name": "motion8", "sensitivity": 5}]}');return e},window.CloudAPI.cameraMotionDetectionRegions=function(){return $.ajax({url:CloudAPI.config.url_cameras+SkyVR.cameraID()+"/motion_detection/regions/",type:"GET"})},window.CloudAPI.cameraP2PSettings=function(e,o,a,n){return e=e||SkyVR.cameraID(),o=void 0==o?SkyVR.handleNothing:o,a=void 0==a?SkyVR.handleError:a,n=void 0==n?SkyVR.handleNothing:n,$.ajax({url:CloudAPI.config.url_cameras+e+"/p2p_settings/",type:"GET",success:function(a){SkyVR.cache.setP2PSettings(e,a),o(a)},error:a,complete:n})},window.CloudAPI.cameraSetP2PSettings=function(e){return $.ajax({url:CloudAPI.config.url_cameras+SkyVR.cameraID()+"/p2p_settings/",type:"PUT",data:JSON.stringify(e),cache:!1,contentType:"application/json"})},window.CloudAPI.cameraLog=function(){return $.ajax({url:CloudAPI.config.url_cameras+SkyVR.cameraID()+"/log/",type:"GET"})},window.CloudAPI.cameraLogDownload=function(e){var o=$.Deferred(),a=null;return a=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),a.onreadystatechange=function(){a.readyState==XMLHttpRequest.DONE&&(200==a.status?o.resolve(a.responseText):o.reject())},a.open("GET",e,!0),a.send(),o.promise()},window.CloudAPI.cameraLogUpdate=function(){return $.ajax({url:CloudAPI.config.url_cameras+SkyVR.cameraID()+"/log/update/",type:"POST"})},window.CloudAPI.cameraManagersList=function(e,o){e=e||SkyVR.handleNothing,o=o||SkyVR.handleError,$.ajax({url:CloudAPI.config.url_cmngrs,type:"GET",success:e,error:o})},window.CloudAPI.camerasList=function(e){function o(e){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_cameras,data:e,cache:!1,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}function a(e){var o=0,a=e.objects.length;o==a&&n.resolve(e);for(var t=0;a>t;t++)cam=e.objects[t],SkyVR.cache.setCameraInfo(cam)?(console.log("update p2p_settings: ",cam.id),SkyVR.cameraP2PSettings(cam.id).done(function(){SkyVR.cameraMemoryCard(cam.id).done(function(){o+=1,o==a&&n.resolve(e)}).fail(function(){o+=1,o==a&&n.resolve(e)})}).fail(function(){o+=1,o==a&&n.resolve(e)})):(o+=1,o==a&&n.resolve(e))}e=e||{};var n=$.Deferred(),t={meta:{limit:20,offset:0,total_count:-1},objects:[]},r={limit:t.meta.limit,offset:t.meta.offset};for(var c in e)r[c]=e[c];return o(r).fail(function(){n.reject()}).done(function(e){if(t.meta.total_count=e.meta.total_count,$.merge(t.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)a(t);else{for(var c=[],i=t.meta.limit;e.meta.total_count>i;i+=t.meta.limit)r.offset=i,c.push(o(r));$.when.apply($,c).done(function(){for(var e=0;arguments.length>e;e++)$.merge(t.objects,arguments[e].objects);a(t)}).fail(function(){n.reject()})}}),n},window.CloudAPI.camerasListByCriterions=function(e,o,a){o=o||SkyVR.handleNothing,a=a||SkyVR.handleError,$.ajax({url:CloudAPI.config.url_cameras,data:e,type:"GET",success:o,error:a})},window.CloudAPI.cameraManagerInfo=function(e,o,a){o=o||SkyVR.handleNothing,a=a||SkyVR.handleError,$.ajax({url:CloudAPI.config.url_cmngrs+e+"/",type:"GET",success:o,error:a})},window.CloudAPI.cameraManagerSetTimezone=function(e,o,a,n){a=a||SkyVR.handleNothing,n=n||SkyVR.handleError;var t={};t.timezone=o,$.ajax({url:CloudAPI.config.url_cmngrs+e+"/",type:"PUT",success:a,error:n,data:JSON.stringify(t),contentType:"application/json"})},window.CloudAPI.storageClipList=function(){function e(e){var o=$.Deferred();return $.ajax({url:SkyVR.config.url_clips,data:e,cache:!1,type:"GET"}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}var o=$.Deferred(),a={meta:{limit:100,offset:0,total_count:-1},objects:[]},n={limit:a.meta.limit,offset:a.meta.offset,camid:SkyVR.cameraID(),usecamtz:""};return e(n).fail(function(){o.reject()}).done(function(t){if(a.meta.total_count=t.meta.total_count,a.meta.expire=t.meta.expire,$.merge(a.objects,t.objects),t.meta.offset+t.objects.length>=t.meta.total_count)o.resolve(a);else{for(var r=[],c=a.meta.limit;t.meta.total_count>c;c+=a.meta.limit)n.offset=c,r.push(e(n));$.when.apply($,r).done(function(){for(var e=0;arguments.length>e;e++)$.merge(a.objects,arguments[e].objects);o.resolve(a)}).fail(function(){o.reject()})}}),o},window.CloudAPI.storageClipListAnon=function(e){var o=$.Deferred();return SkyVR.anonToken().done(function(a){function n(e){var o=$.Deferred();return $.ajax({url:SkyVR.config.url_clips,data:e,cache:!1,type:"GET",headers:{Authorization:"SkyVR "+a.token}}).done(function(e){o.resolve(e)}).fail(function(){o.reject()}),o}var t={meta:{limit:100,offset:0,total_count:-1},objects:[]},r={limit:t.meta.limit,offset:t.meta.offset,usecamtz:""};e&&(r.token=e),n(r).fail(function(){o.reject()}).done(function(e){if(t.meta.total_count=e.meta.total_count,t.meta.expire=e.meta.expire,$.merge(t.objects,e.objects),e.meta.offset+e.objects.length>=e.meta.total_count)o.resolve(t);else{for(var a=[],c=t.meta.limit;e.meta.total_count>c;c+=t.meta.limit)r.offset=c,a.push(n(r));$.when.apply($,a).done(function(){for(var e=0;arguments.length>e;e++)$.merge(t.objects,arguments[e].objects);o.resolve(t)}).fail(function(){o.reject()})}})}).fail(function(){o.reject()}),o},window.CloudAPI.storageClipCreate=function(e,o,a,n,t){var r={};return r.camid=SkyVR.cameraID(),r.title=e,r.group=o,r.start=a,r.end=n,r.delete_at=t,$.ajax({url:CloudAPI.config.url_clips,type:"POST",data:JSON.stringify(r),cache:!1,contentType:"application/json"})},window.CloudAPI.storageClip=function(e){return $.ajax({url:SkyVR.config.url_clips+e+"/",type:"GET",cache:!1})},window.CloudAPI.serverTime=function(){return $.ajax({url:CloudAPI.config.url_server+"time/",type:"GET",cache:!1})},window.CloudAPI.storageClipAnon=function(e,o){var a=$.Deferred(),n={};return o&&(n.token=o),SkyVR.anonToken().done(function(o){$.ajax({url:SkyVR.config.url_clips+e+"/",type:"GET",data:n,cache:!1,headers:{Authorization:"SkyVR "+o.token}}).done(function(e){a.resolve(e)}).fail(function(){a.reject()})}).fail(function(){a.reject()}),a},window.CloudAPI.storageClipDelete=function(e){return $.ajax({url:CloudAPI.config.url_clips+e+"/",type:"DELETE",cache:!1})},window.CloudAPI.storageClipUpdate=function(e,o){return $.ajax({url:CloudAPI.config.url_clips+e+"/",data:JSON.stringify(o),type:"PUT",cache:!1,contentType:"application/json"})},window.CloudAPI.storageActivity=function(){var e={camid:SkyVR.cameraID(),daysincamtz:""};return $.ajax({url:SkyVR.config.url_storage+"activity/",type:"GET",data:e,cache:!1})},CloudAPI.cameraSettings=function(){function e(e){var o=$.Deferred();return e.always(function(){o.resolve()}),o}function o(){var e=$.Deferred();return CloudAPI.cameraMediaStreams().done(function(o){console.log("MediaStreams: ",o);var a=o.mstreams_supported,n=o.live_ms_id;if(a.length>0&&""!=n){for(var t="",r=0;a.length>r;r++)if(a[r].id==n){t=a[r].vs_id;break}""!=t?CloudAPI.cameraVideoStream(t).done(function(){e.resolve()}).fail(function(){e.reject()}):e.reject()}else e.resolve()}).fail(function(){e.reject()}),e}var a=$.Deferred(),n=[];return n.push(e(o())),SkyVR.cache.cameraInfo().url||(n.push(e(SkyVR.cameraVideo())),n.push(e(SkyVR.cameraAudio())),n.push(e(SkyVR.cameraLimits())),n.push(e(SkyVR.cameraEventProcessingEventsMotion())),n.push(e(SkyVR.cameraEventProcessingEventsSound())),n.push(e(SkyVR.cameraMemoryCard()))),$.when.apply($,n).done(function(){a.resolve(SkyVR.cache.cameraInfo())}).fail(function(){a.reject()}),a},CloudAPI.camsessList=function(e){return e=e||{},$.ajax({url:CloudAPI.config.url_camsess,data:e,type:"GET",cache:!1})},CloudAPI.camsessInfo=function(e,o){return o=o||{},$.ajax({url:CloudAPI.config.url_camsess+e+"/",data:o,type:"GET",cache:!1})},CloudAPI.camsessRecords=function(e,o){return o=o||{},$.ajax({url:CloudAPI.config.url_camsess+e+"/records/",data:o,type:"GET",cache:!1})},window.CloudAPI.cameraCreate=function(e){var o=$.Deferred();return e=e||{},$.ajax({url:CloudAPI.config.url_cameras,type:"POST",data:JSON.stringify(e),cache:!1,contentType:"application/json"}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}),o},CloudAPI.cameraDelete=function(e){var o=$.Deferred();return $.ajax({url:CloudAPI.config.url_cameras+e+"/",type:"DELETE",cache:!1}).done(function(e){o.resolve(e)}).fail(function(e){o.reject(e)}),o},CloudAPI.cameraUpdate=function(e,o){var a=$.Deferred();return o=o||{},$.ajax({url:CloudAPI.config.url_cameras+e+"/",type:"PUT",data:JSON.stringify(o),cache:!1,contentType:"application/json"}).done(function(e){a.resolve(e)}).fail(function(e){a.reject(e)}),a},CloudAPI.adminCameras=function(e){return e=e||{},$.ajax({url:CloudAPI.config.url_admin_cameras,data:e,type:"GET",cache:!1})},CloudAPI.adminCameraInfo=function(e){return $.ajax({url:CloudAPI.config.url_admin_cameras+e+"/",type:"GET",cache:!1})},CloudAPI.updateAdminCamera=function(e,o){return o=o||{},$.ajax({url:CloudAPI.config.url_admin_cameras+e+"/",type:"PUT",data:JSON.stringify(o),contentType:"application/json",cache:!1})},CloudAPI.store={},CloudAPI.store.volume=function(e){return e&&CloudAPI.setToStorage("volume",e),CloudAPI.getFromStorage("volume")},CloudAPI.store.prev_volume=function(e){return e&&CloudAPI.setToStorage("prev_volume",e),CloudAPI.getFromStorage("prev_volume")},CloudAPI.store.zoom=function(e){return void 0!=e&&CloudAPI.setToStorage("zoom",e),CloudAPI.getFromStorage("zoom")},CloudAPI.store.zoom_left=function(e){return void 0!=e&&CloudAPI.setToStorage("zoom_left",e),CloudAPI.getFromStorage("zoom_left")},CloudAPI.store.zoom_top=function(e){return void 0!=e&&CloudAPI.setToStorage("zoom_top",e),CloudAPI.getFromStorage("zoom_top")},CloudAPI.store.user_profile=function(e){return void 0!=e&&CloudAPI.setToStorage("user_profile",e),CloudAPI.getFromStorage("user_profile")},CloudAPI.store.svcp_host=function(e){return void 0!=e&&CloudAPI.setToStorage("svcp_host",e),CloudAPI.getFromStorage("svcp_host")},CloudAPI.storageTemp={},CloudAPI.storageMode="local",CloudAPI.detectStorageMode=function(){try{localStorage.setItem("detectStorageMode","yes")}catch(e){CloudAPI.storageMode="temp"}},CloudAPI.detectStorageMode(),CloudAPI.setToStorage=function(e,o){"local"==CloudAPI.storageMode?localStorage.setItem(e,o):CloudAPI.storageTemp[e]=o},CloudAPI.getFromStorage=function(e){return"local"==CloudAPI.storageMode?localStorage.getItem(e):CloudAPI.storageTemp[e]},CloudAPI.removeFromStorage=function(e){"local"==CloudAPI.storageMode?localStorage.removeItem(e):CloudAPI.storageTemp[e]=void 0},CloudAPI.loadApiTokenFromHref=function(){var e=window.location.href.split("#"),o=e[e.length-1];o=o.split("&");for(var a in o){var n=o[a].split("=")[0],t=decodeURIComponent(o[a].split("=")[1]);"token"==n?(CloudAPI.config.apiToken.token=t,CloudAPI.config.apiToken.type="api"):"expire"==n&&(CloudAPI.config.apiToken.expire=t,CloudAPI.config.apiToken.expireTimeUTC=Date.parse(t+"Z"))}console.log("Href token: ",CloudAPI.config.apiToken),CloudAPI.setToStorage("SkyVR_apiToken",JSON.stringify(CloudAPI.config.apiToken))},CloudAPI.flashVersion=void 0,CloudAPI.getFlashVersion=function(){try{try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");try{e.AllowScriptAccess="always"}catch(o){return"6,0,0"}}catch(o){}return new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version").replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(o){try{if(navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return(navigator.plugins["Shockwave Flash 2.0"]||navigator.plugins["Shockwave Flash"]).description.replace(/\D+/g,",").match(/^,?(.+),?$/)[1]}catch(o){}}return"0,0,0"},window.CloudAPI.supportFlash=function(){return CloudAPI.flashVersion||(CloudAPI.flashVersion=CloudAPI.getFlashVersion()),"0,0,0"!=CloudAPI.flashVersion},window.CloudAPI.usedHls=function(){return!CloudAPI.supportFlash()||CloudAPI.containsPageParam("hls")},CloudAPI.containsPageParam("svcp_host")?CloudAPI.setURL(CloudAPI.pageParams.svcp_host):CloudAPI.getFromStorage("CloudAPI_svcp_host")?CloudAPI.setURL(CloudAPI.getFromStorage("CloudAPI_svcp_host")):CloudAPI.setURL(window.location.protocol+"//"+(""+window.location.host)+"/");